{% extends 'layout-analysis.html' %}
{% load staticfiles %}
{% load jsonify %}

{% block heading %}Submission - Astrometry{% endblock %}

{% block content-interior %}
<ol class="breadcrumb">
  <li class="active">Astrometry</li>
  <li><a href="#">Point Sources</a></li>
  <li><a href="#">Reference Stars</a></li>
  <li><a href="#">Reduction</a></li>
  <li><a href="#">Light Curve</a></li>
</ol>

<h3>Original image</h3>
<div class="well">
  <img src="{{result.urls.original_display_url}}" />
  <a href="{{result.urls.original_display_url}}" download>Download</a>
</div>

<h3>Date &amp; time</h3>
<p>
Parsed from fits <code>DATE-OBS</code> field (ISO 8601 format).
</p>
<div class="well">
  <div id="edit-image-datetime-success" class="alert alert-success" style="display:none">
    Date and time successfully updated.
  </div>
  <div id="edit-image-datetime-success" class="alert alert-danger" style="display:none">
    Something went wrong - failed to update your setting.
  </div>
  <input id="edit-image-datetime" class="form-control" style="width: 30em" type="text" value="{{result.meta.image_datetime | date:'c'}}">
</div>

<h3>Filter</h3>
<p>
Select the standard filter that most closely matches the filter used for this image.
</p>
<div class="well">
  <div id="select-filter-name-success" class="alert alert-success" style="display:none">
    Filter successfully updated.
  </div>
  <div id="select-filter-name-failure" class="alert alert-danger" style="display:none">
    Something went wrong - failed to update your setting.
  </div>
  <label>
    <select class="form-control" id="select-filter-name">
      {% for filter in image_filters %}
        <option value="{{filter.band}}">{{filter.band}} ({{filter.system}})</option>
      {% endfor %}
    </select>
  </label>
</div>

<h3>Point source coordinates</h3>
<a href="{{result.urls.coords_json_url}}">Coordinates JSON</a>
&middot;
<a href="{{result.urls.coords_fits_url}}">Coordinates FITS</a>
<div class="well">
  <img src="{{result.urls.coords_plot_url}}" />
  <a href="{{result.urls.coords_plot_url}}" download>Download</a>
</div>

<h3>Instrumental photometry</h3>
<div class="well" style="overflow: auto; max-height: 400px">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Field X</th>
        <th>Field Y</th>
        <th>Estimated flux</th>
        <th>Estimated magnitude</th>
      </tr>
    </thead>
    <tbody>
      {% for point_source in result.data.coords %}
        <tr>
          <td>{{point_source.field_x}}</td>
          <td>{{point_source.field_y}}</td>
          <td>{{point_source.est_flux}}</td>
          <td>{{point_source.est_mag}}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div style="text-align: right">
  <a href="javascript:window.history.back()" class="btn btn-lg btn-default">Back</a>
  <a href="/submission/point_sources/{{result.subid}}"
     class="btn btn-lg btn-success">View point source analysis</a>
</div>
{% endblock %}

{% csrf_token %}

{% block scripts %}
  <script>
    window.subid = {{result.subid | jsonify }};
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="{% static "imageflow/js/submission_astrometry.js" %}" type="text/javascript"></script>
{% endblock %}
